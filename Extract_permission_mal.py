import os
import csv

perm_fptr = open('all_per.txt', 'r')
perm_lines = perm_fptr.readlines()
perm_lines = [x.strip() for x in perm_lines] 
perm_fptr.close()

b = open('Generated_features_mal.csv', 'w')
a = csv.writer(b)
a.writerow(perm_lines)

features_list=list()
for filename in os.listdir("/Malgenome"):
	# print filename
	if os.path.isdir("/Malgenome/"+filename):
		for f in os.listdir("/Malgenome/"+filename):
			# print f
			cmd="aapt dump permissions /Malgenome/"+filename+"/"+f+" >> check_mal.txt"
			# cmd="aapt dump permissions "+f+" > check2.txt"
			# print cmd
			os.system(cmd)
			check_fptr=open("check_mal.txt",'r')
			check_rows=check_fptr.readlines()
			check_rows=[x.strip() for x in check_rows]
			features=list()
			for perm in perm_lines:
				if any(perm in row for row in check_rows):
					# print perm
					features.append(1)
				else:
					features.append(0)

			check_fptr.close()
			features.append(f)
			features_list.append(features)


 	


a.writerows(features_list)
b.close()
